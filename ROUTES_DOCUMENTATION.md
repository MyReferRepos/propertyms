# å‰ç«¯è·¯ç”±å®Œæ•´æ–‡æ¡£

**ç”Ÿæˆæ—¶é—´**: 2025-10-27
**æ¡†æ¶**: TanStack Router v1.x

---

## ğŸ“‹ ç›®å½•

- [è·¯ç”±ç»“æ„æ¦‚è§ˆ](#è·¯ç”±ç»“æ„æ¦‚è§ˆ)
- [è®¤è¯è·¯ç”±](#è®¤è¯è·¯ç”±)
- [è®¤è¯åè·¯ç”±](#è®¤è¯åè·¯ç”±)
- [ç”¨æˆ·ç®¡ç†æ¨¡å—](#ç”¨æˆ·ç®¡ç†æ¨¡å—)
- [èœå•ç®¡ç†æ¨¡å—](#èœå•ç®¡ç†æ¨¡å—)
- [è®¾ç½®æ¨¡å—](#è®¾ç½®æ¨¡å—)
- [é”™è¯¯é¡µé¢](#é”™è¯¯é¡µé¢)
- [è·¯ç”±å®ˆå«è¯´æ˜](#è·¯ç”±å®ˆå«è¯´æ˜)

---

## ğŸ—ºï¸ è·¯ç”±ç»“æ„æ¦‚è§ˆ

```
/
â”œâ”€â”€ (auth)/                    # è®¤è¯ç›¸å…³è·¯ç”±ç»„ï¼ˆä¸å½±å“URLï¼‰
â”‚   â”œâ”€â”€ sign-in               # ç™»å½•
â”‚   â”œâ”€â”€ sign-up               # æ³¨å†Œ
â”‚   â”œâ”€â”€ forgot-password       # å¿˜è®°å¯†ç 
â”‚   â””â”€â”€ otp                   # OTPéªŒè¯
â”‚
â”œâ”€â”€ _authenticated/            # éœ€è¦è®¤è¯çš„è·¯ç”±ï¼ˆè·¯ç”±å®ˆå«ï¼‰
â”‚   â”œâ”€â”€ /                     # é¦–é¡µ/ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ demo                  # æ¡†æ¶æ¼”ç¤º
â”‚   â”‚
â”‚   â”œâ”€â”€ users/                # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ /                 # ç”¨æˆ·åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ roles             # è§’è‰²ç®¡ç†
â”‚   â”‚   â””â”€â”€ permissions       # æƒé™ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ menu/                 # èœå•ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ /                 # èœå•ç»¼åˆç®¡ç†
â”‚   â”‚   â”œâ”€â”€ groups            # èœå•ç»„ç®¡ç†
â”‚   â”‚   â””â”€â”€ items             # èœå•é¡¹ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ settings/             # è®¾ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ general           # é€šç”¨è®¾ç½®
â”‚   â”‚   â””â”€â”€ profile           # ä¸ªäººèµ„æ–™
â”‚   â”‚
â”‚   â””â”€â”€ errors/               # é”™è¯¯é¡µé¢
â”‚       â””â”€â”€ :error            # åŠ¨æ€é”™è¯¯é¡µ
â”‚
â””â”€â”€ (errors)/                  # é”™è¯¯é¡µé¢è·¯ç”±ç»„
    â”œâ”€â”€ 401                   # æœªæˆæƒ
    â”œâ”€â”€ 403                   # ç¦æ­¢è®¿é—®
    â”œâ”€â”€ 404                   # é¡µé¢æœªæ‰¾åˆ°
    â”œâ”€â”€ 500                   # æœåŠ¡å™¨é”™è¯¯
    â””â”€â”€ 503                   # æœåŠ¡ä¸å¯ç”¨
```

---

## ğŸ” è®¤è¯è·¯ç”± (æ— éœ€ç™»å½•)

### 1. ç™»å½•é¡µé¢
- **è·¯å¾„**: `/sign-in`
- **æ–‡ä»¶**: `src/routes/(auth)/sign-in.tsx`
- **åŠŸèƒ½**: ç”¨æˆ·ç™»å½•
- **è¡¨å•å­—æ®µ**:
  - é‚®ç®± (email)
  - å¯†ç  (password)
- **ç›¸å…³åŠŸèƒ½**:
  - è®°ä½æˆ‘
  - å¿˜è®°å¯†ç é“¾æ¥
  - æ³¨å†Œé“¾æ¥

### 2. æ³¨å†Œé¡µé¢
- **è·¯å¾„**: `/sign-up`
- **æ–‡ä»¶**: `src/routes/(auth)/sign-up.tsx`
- **åŠŸèƒ½**: æ–°ç”¨æˆ·æ³¨å†Œ
- **è¡¨å•å­—æ®µ**:
  - ç”¨æˆ·å
  - é‚®ç®±
  - å¯†ç 
  - ç¡®è®¤å¯†ç 

### 3. å¿˜è®°å¯†ç 
- **è·¯å¾„**: `/forgot-password`
- **æ–‡ä»¶**: `src/routes/(auth)/forgot-password.tsx`
- **åŠŸèƒ½**: å¯†ç é‡ç½®è¯·æ±‚
- **æµç¨‹**: å‘é€é‡ç½®é‚®ä»¶

### 4. OTPéªŒè¯
- **è·¯å¾„**: `/otp`
- **æ–‡ä»¶**: `src/routes/(auth)/otp.tsx`
- **åŠŸèƒ½**: åŒå› ç´ è®¤è¯
- **éªŒè¯æ–¹å¼**: OTPç éªŒè¯

---

## âœ… è®¤è¯åè·¯ç”± (éœ€è¦ç™»å½•)

### 1. é¦–é¡µ/ä»ªè¡¨ç›˜
- **è·¯å¾„**: `/`
- **æ–‡ä»¶**: `src/routes/_authenticated/index.tsx`
- **æƒé™è¦æ±‚**: å·²ç™»å½•
- **åŠŸèƒ½**:
  - ç³»ç»Ÿæ¦‚è§ˆ
  - å¿«é€Ÿè®¿é—®
  - æ•°æ®ç»Ÿè®¡

### 2. æ¡†æ¶æ¼”ç¤º
- **è·¯å¾„**: `/demo`
- **æ–‡ä»¶**: `src/routes/_authenticated/demo.tsx`
- **æƒé™è¦æ±‚**: å·²ç™»å½•
- **åŠŸèƒ½**: å±•ç¤ºæ¡†æ¶ç‰¹æ€§å’Œç»„ä»¶

---

## ğŸ‘¥ ç”¨æˆ·ç®¡ç†æ¨¡å—

### 1. ç”¨æˆ·åˆ—è¡¨
- **è·¯å¾„**: `/users`
- **æ–‡ä»¶**: `src/routes/_authenticated/users/index.tsx`
- **æƒé™è¦æ±‚**: `user:view` (æ¨è)
- **åŠŸèƒ½**:
  - ç”¨æˆ·åˆ—è¡¨å±•ç¤º
  - ç”¨æˆ·æœç´¢/è¿‡æ»¤
  - ç”¨æˆ·åˆ›å»º
  - ç”¨æˆ·ç¼–è¾‘
  - ç”¨æˆ·åˆ é™¤
  - æ‰¹é‡æ“ä½œ
  - çŠ¶æ€ç®¡ç†
- **å…³è”API**:
  - `GET /api/Users` - è·å–ç”¨æˆ·åˆ—è¡¨
  - `POST /api/Users` - åˆ›å»ºç”¨æˆ·
  - `PUT /api/Users/{id}` - æ›´æ–°ç”¨æˆ·
  - `DELETE /api/Users/{id}` - åˆ é™¤ç”¨æˆ·

### 2. è§’è‰²ç®¡ç†
- **è·¯å¾„**: `/users/roles`
- **æ–‡ä»¶**: `src/routes/_authenticated/users/roles.tsx`
- **æƒé™è¦æ±‚**: `role:view` (æ¨è)
- **åŠŸèƒ½**:
  - è§’è‰²åˆ—è¡¨å±•ç¤º
  - è§’è‰²åˆ›å»º/ç¼–è¾‘/åˆ é™¤
  - æƒé™åˆ†é…
  - è§’è‰²æˆå‘˜æŸ¥çœ‹
- **å…³è”API**:
  - `GET /api/Roles` - è·å–è§’è‰²åˆ—è¡¨
  - `POST /api/Roles` - åˆ›å»ºè§’è‰²
  - `PUT /api/Roles/{id}` - æ›´æ–°è§’è‰²
  - `GET /api/Roles/{id}/permissions` - è·å–è§’è‰²æƒé™
  - `PUT /api/Roles/{id}/permissions` - æ›´æ–°è§’è‰²æƒé™

### 3. æƒé™ç®¡ç†
- **è·¯å¾„**: `/users/permissions`
- **æ–‡ä»¶**: `src/routes/_authenticated/users/permissions.tsx`
- **æƒé™è¦æ±‚**: `permission:view` (æ¨è)
- **åŠŸèƒ½**:
  - æƒé™åˆ—è¡¨å±•ç¤ºï¼ˆæ ‘å½¢/è¡¨æ ¼ï¼‰
  - æƒé™åˆ›å»ºï¼ˆModule/Actionç±»å‹ï¼‰
  - æƒé™ç¼–è¾‘/åˆ é™¤
  - æƒé™æœç´¢/è¿‡æ»¤
  - Module-Actionå±‚çº§ç®¡ç†
- **æƒé™ç±»å‹**:
  - **Module**: æ¨¡å—æƒé™ï¼ˆå¦‚"ç”¨æˆ·ç®¡ç†æ¨¡å—"ï¼‰
  - **Action**: æ“ä½œæƒé™ï¼ˆå¦‚"åˆ›å»ºç”¨æˆ·"ã€"åˆ é™¤ç”¨æˆ·"ï¼‰
- **å…³è”API**:
  - `GET /api/Permissions` - è·å–æƒé™åˆ—è¡¨
  - `GET /api/Permissions/tree` - è·å–æƒé™æ ‘
  - `POST /api/Permissions` - åˆ›å»ºæƒé™
  - `PUT /api/Permissions/{id}` - æ›´æ–°æƒé™
  - `DELETE /api/Permissions/{id}` - åˆ é™¤æƒé™

---

## ğŸ” èœå•ç®¡ç†æ¨¡å—

### 1. èœå•ç»¼åˆç®¡ç†
- **è·¯å¾„**: `/menu`
- **æ–‡ä»¶**: `src/routes/_authenticated/menu/index.tsx`
- **æƒé™è¦æ±‚**: `menu:view` (æ¨è)
- **åŠŸèƒ½**:
  - èœå•ç»„å’Œèœå•é¡¹çš„ç»¼åˆç®¡ç†ç•Œé¢
  - æ ‡ç­¾é¡µåˆ‡æ¢å±•ç¤º

### 2. èœå•ç»„ç®¡ç†
- **è·¯å¾„**: `/menu/groups`
- **æ–‡ä»¶**: `src/routes/_authenticated/menu/groups.tsx`
- **æƒé™è¦æ±‚**: `menu_group:view` (æ¨è)
- **åŠŸèƒ½**:
  - èœå•ç»„åˆ—è¡¨
  - èœå•ç»„åˆ›å»º/ç¼–è¾‘/åˆ é™¤
  - æ’åºç®¡ç†
  - çŠ¶æ€ç®¡ç†
- **å…³è”API**:
  - `GET /api/menu-groups` - è·å–èœå•ç»„åˆ—è¡¨
  - `POST /api/menu-groups` - åˆ›å»ºèœå•ç»„
  - `PUT /api/menu-groups/{id}` - æ›´æ–°èœå•ç»„
  - `DELETE /api/menu-groups/{id}` - åˆ é™¤èœå•ç»„

### 3. èœå•é¡¹ç®¡ç†
- **è·¯å¾„**: `/menu/items`
- **æ–‡ä»¶**: `src/routes/_authenticated/menu/items.tsx`
- **æƒé™è¦æ±‚**: `menu_item:view` (æ¨è)
- **åŠŸèƒ½**:
  - èœå•é¡¹æ ‘å½¢å±•ç¤º
  - èœå•é¡¹åˆ›å»º/ç¼–è¾‘/åˆ é™¤
  - çˆ¶å­å…³ç³»ç®¡ç†
  - æƒé™å…³è”
  - å›¾æ ‡é€‰æ‹©
  - æ’åºç®¡ç†
- **èœå•ç±»å‹**:
  - **Directory**: ç›®å½•ï¼ˆå®¹å™¨èŠ‚ç‚¹ï¼‰
  - **Menu**: èœå•ï¼ˆå®é™…é¡µé¢ï¼‰
  - **Action**: æ“ä½œï¼ˆæŒ‰é’®/æ“ä½œé¡¹ï¼‰
- **å…³è”API**:
  - `GET /api/menus` - è·å–èœå•åˆ—è¡¨
  - `GET /api/menus/tree` - è·å–èœå•æ ‘
  - `POST /api/menus` - åˆ›å»ºèœå•
  - `PUT /api/menus/{id}` - æ›´æ–°èœå•
  - `DELETE /api/menus/{id}` - åˆ é™¤èœå•
  - `PUT /api/menus/sort` - æ›´æ–°æ’åº

---

## âš™ï¸ è®¾ç½®æ¨¡å—

### 1. é€šç”¨è®¾ç½®
- **è·¯å¾„**: `/settings/general`
- **æ–‡ä»¶**: `src/routes/_authenticated/settings/general.tsx`
- **æƒé™è¦æ±‚**: å·²ç™»å½•
- **åŠŸèƒ½**:
  - ç³»ç»Ÿé€šç”¨è®¾ç½®
  - è¯­è¨€åˆ‡æ¢
  - ä¸»é¢˜è®¾ç½®
  - å…¶ä»–å…¨å±€é…ç½®

### 2. ä¸ªäººèµ„æ–™
- **è·¯å¾„**: `/settings/profile`
- **æ–‡ä»¶**: `src/routes/_authenticated/settings/profile.tsx`
- **æƒé™è¦æ±‚**: å·²ç™»å½•
- **åŠŸèƒ½**:
  - ä¸ªäººä¿¡æ¯ç¼–è¾‘
  - å¤´åƒä¸Šä¼ 
  - å¯†ç ä¿®æ”¹
  - è´¦å·å®‰å…¨è®¾ç½®
- **å…³è”API**:
  - `GET /api/Auth/profile` - è·å–ä¸ªäººä¿¡æ¯
  - `PUT /api/Auth/profile` - æ›´æ–°ä¸ªäººä¿¡æ¯
  - `PUT /api/Auth/change-password` - ä¿®æ”¹å¯†ç 

---

## âŒ é”™è¯¯é¡µé¢

### 1. 401 - æœªæˆæƒ
- **è·¯å¾„**: `/401`
- **æ–‡ä»¶**: `src/routes/(errors)/401.tsx`
- **è§¦å‘åœºæ™¯**:
  - æœªç™»å½•è®¿é—®éœ€è¦è®¤è¯çš„é¡µé¢
  - Tokenè¿‡æœŸæˆ–æ— æ•ˆ

### 2. 403 - ç¦æ­¢è®¿é—®
- **è·¯å¾„**: `/403`
- **æ–‡ä»¶**: `src/routes/(errors)/403.tsx`
- **è§¦å‘åœºæ™¯**:
  - å·²ç™»å½•ä½†æ— æƒé™è®¿é—®æŸé¡µé¢
  - æƒé™ä¸è¶³

### 3. 404 - é¡µé¢æœªæ‰¾åˆ°
- **è·¯å¾„**: `/404`
- **æ–‡ä»¶**: `src/routes/(errors)/404.tsx`
- **è§¦å‘åœºæ™¯**:
  - è®¿é—®ä¸å­˜åœ¨çš„è·¯ç”±
  - è·¯ç”±é…ç½®é”™è¯¯

### 4. 500 - æœåŠ¡å™¨é”™è¯¯
- **è·¯å¾„**: `/500`
- **æ–‡ä»¶**: `src/routes/(errors)/500.tsx`
- **è§¦å‘åœºæ™¯**:
  - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  - åç«¯å¼‚å¸¸

### 5. 503 - æœåŠ¡ä¸å¯ç”¨
- **è·¯å¾„**: `/503`
- **æ–‡ä»¶**: `src/routes/(errors)/503.tsx`
- **è§¦å‘åœºæ™¯**:
  - æœåŠ¡ç»´æŠ¤ä¸­
  - æœåŠ¡å™¨è¿‡è½½

### 6. åŠ¨æ€é”™è¯¯é¡µ
- **è·¯å¾„**: `/errors/:error`
- **æ–‡ä»¶**: `src/routes/_authenticated/errors/$error.tsx`
- **åŠŸèƒ½**:
  - åŠ¨æ€å±•ç¤ºä¸åŒç±»å‹çš„é”™è¯¯
  - é€šè¿‡URLå‚æ•°ä¼ é€’é”™è¯¯ç±»å‹

---

## ğŸ›¡ï¸ è·¯ç”±å®ˆå«è¯´æ˜

### è®¤è¯å®ˆå«
- **ä½ç½®**: `src/routes/_authenticated/route.tsx`
- **åŠŸèƒ½**:
  - éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
  - æœªç™»å½•é‡å®šå‘åˆ° `/sign-in`
  - åŠ è½½ç”¨æˆ·ä¿¡æ¯å’Œæƒé™

### æƒé™å®ˆå«
- **å·¥å…·å‡½æ•°**:
  - `requirePermission(permission: string)` - è¦æ±‚å•ä¸ªæƒé™
  - `requireAnyPermission(permissions: string[])` - è¦æ±‚ä»»æ„æƒé™ï¼ˆORï¼‰
  - `requireAllPermissions(permissions: string[])` - è¦æ±‚æ‰€æœ‰æƒé™ï¼ˆANDï¼‰

- **ä½¿ç”¨ç¤ºä¾‹**:
```typescript
export const Route = createFileRoute('/_authenticated/users')({
  beforeLoad: async () => {
    requirePermission('user:view')
  },
})
```

### æƒé™éªŒè¯æµç¨‹
1. ç”¨æˆ·è®¿é—®å—ä¿æŠ¤è·¯ç”±
2. è·¯ç”±å®ˆå«æ£€æŸ¥ç™»å½•çŠ¶æ€
3. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰æ‰€éœ€æƒé™
4. æ— æƒé™æ—¶é‡å®šå‘åˆ° `/403`
5. æœ‰æƒé™æ—¶æ­£å¸¸åŠ è½½é¡µé¢

---

## ğŸ“Š è·¯ç”±ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ |
|------|------|
| è®¤è¯è·¯ç”± | 4 |
| è®¤è¯åè·¯ç”± | 2 |
| ç”¨æˆ·ç®¡ç† | 3 |
| èœå•ç®¡ç† | 3 |
| è®¾ç½®é¡µé¢ | 2 |
| é”™è¯¯é¡µé¢ | 6 |
| **æ€»è®¡** | **20** |

---

## ğŸ”— è·¯ç”±å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨è·¯ç”±
```typescript
// è®¤è¯
'/sign-in'          // ç™»å½•
'/sign-up'          // æ³¨å†Œ
'/forgot-password'  // å¿˜è®°å¯†ç 

// ä¸»è¦åŠŸèƒ½
'/'                 // é¦–é¡µ
'/users'            // ç”¨æˆ·ç®¡ç†
'/users/roles'      // è§’è‰²ç®¡ç†
'/users/permissions'// æƒé™ç®¡ç†
'/menu'             // èœå•ç®¡ç†
'/settings/profile' // ä¸ªäººèµ„æ–™

// é”™è¯¯å¤„ç†
'/401'              // æœªæˆæƒ
'/403'              // ç¦æ­¢è®¿é—®
'/404'              // é¡µé¢æœªæ‰¾åˆ°
```

---

## ğŸš€ è·¯ç”±å¯¼èˆª

### ç¼–ç¨‹å¼å¯¼èˆª
```typescript
import { useNavigate } from '@tanstack/react-router'

const navigate = useNavigate()

// å¯¼èˆªåˆ°ç”¨æˆ·åˆ—è¡¨
navigate({ to: '/users' })

// å¸¦æŸ¥è¯¢å‚æ•°
navigate({
  to: '/users',
  search: { page: 1, pageSize: 10 }
})

// å¯¼èˆªåˆ°åŠ¨æ€è·¯ç”±
navigate({
  to: '/errors/$error',
  params: { error: '404' }
})
```

### å£°æ˜å¼å¯¼èˆª
```tsx
import { Link } from '@tanstack/react-router'

// åŸºæœ¬é“¾æ¥
<Link to="/users">ç”¨æˆ·ç®¡ç†</Link>

// å¸¦æŸ¥è¯¢å‚æ•°
<Link to="/users" search={{ page: 1 }}>
  ç”¨æˆ·ç®¡ç†
</Link>

// å¸¦æƒé™æ£€æŸ¥çš„é“¾æ¥
{hasPermission('user:view') && (
  <Link to="/users">ç”¨æˆ·ç®¡ç†</Link>
)}
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è·¯ç”±ç»„è¯­æ³•**:
   - `(auth)` å’Œ `(errors)` æ˜¯è·¯ç”±ç»„ï¼Œä¸ä¼šå‡ºç°åœ¨å®é™…URLä¸­
   - ç”¨äºç»„ç»‡ç›¸å…³è·¯ç”±å’Œå…±äº«å¸ƒå±€

2. **è®¤è¯è·¯ç”±å‰ç¼€**:
   - `_authenticated` ç›®å½•ä¸‹çš„æ‰€æœ‰è·¯ç”±éƒ½éœ€è¦ç™»å½•
   - ä¼šè‡ªåŠ¨åº”ç”¨è®¤è¯å®ˆå«

3. **åŠ¨æ€è·¯ç”±å‚æ•°**:
   - `$error` è¡¨ç¤ºåŠ¨æ€å‚æ•°ï¼Œä½¿ç”¨æ—¶éœ€æä¾›å…·ä½“å€¼
   - ä¾‹å¦‚: `/errors/404`

4. **æƒé™å‘½åå»ºè®®**:
   - æ ¼å¼: `resource:operation`
   - ä¾‹å¦‚: `user:view`, `user:create`, `role:assign-permissions`

5. **èœå•ä¸è·¯ç”±åŒæ­¥**:
   - æ•°æ®åº“ä¸­çš„èœå•é¡¹éœ€è¦ä¸è·¯ç”±è·¯å¾„ä¿æŒä¸€è‡´
   - ä½¿ç”¨ `scripts/sync-menus.ts` è¿›è¡ŒåŒæ­¥

---

**æ–‡æ¡£ç»´æŠ¤**: æ¯æ¬¡æ·»åŠ æˆ–ä¿®æ”¹è·¯ç”±æ—¶ï¼Œè¯·åŒæ­¥æ›´æ–°æ­¤æ–‡æ¡£ã€‚
